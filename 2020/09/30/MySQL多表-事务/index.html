



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="手撕包菜" href="https://www.baocai-blog.cn/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="手撕包菜" href="https://www.baocai-blog.cn/atom.xml" />
<link rel="alternate" type="application/json" title="手撕包菜" href="https://www.baocai-blog.cn/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2">

  
  <meta name="keywords" content="MySQL" />



<meta name="description" content="" >


<link rel="canonical" href="https://www.baocai-blog.cn/2020/09/30/MySQL%E5%A4%9A%E8%A1%A8-%E4%BA%8B%E5%8A%A1/">



  <title>
MySQL多表和事务 - 数据库 |
baocai's blog = 手撕包菜 = 学习笔记</title>
<meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">MySQL多表和事务
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2020-09-30 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2020-09-30T00:00:00+08:00">2020-09-30</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>8.3k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>8 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">baocai's blog</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicljitigmj20zk0m87fp.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicm0n457cj20zk0m8e81.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipevuctzzj20zk0m84qp.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclj9410cj20zk0m8h12.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipeybxm1pj20zk0m8niv.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giph4fomxoj20zk0m8axp.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main id="main">
      <div class="inner">
        <div id="content" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="item" rel="index" title="分类于 数据库"><span itemprop="name">数据库</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://www.baocai-blog.cn/2020/09/30/MySQL%E5%A4%9A%E8%A1%A8-%E4%BA%8B%E5%8A%A1/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="手撕包菜">
    <meta itemprop="description" content="学习笔记, ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="手撕包菜">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <hr>
<h1 id="目录"><a class="anchor" href="#目录">#</a> 目录</h1>
<ol>
<li>
<p>多表查询</p>
</li>
<li>
<p>事务</p>
</li>
<li>
<p>DCL</p>
</li>
</ol>
<h2 id="多表查询"><a class="anchor" href="#多表查询">#</a> 多表查询：</h2>
<ul>
<li>
<p>查询语法：<br>
select<br>
 列名列表<br>
 from<br>
 表名列表<br>
 where....</p>
</li>
<li>
<p>准备 sql</p>
<h3 id="创建部门表"><a class="anchor" href="#创建部门表">#</a> 创建部门表</h3>
<p>CREATE TABLE dept(<br>
id INT PRIMARY KEY AUTO_INCREMENT,<br>
NAME VARCHAR(20)<br>
);<br>
INSERT INTO dept (NAME) VALUES (' 开发部 '),(' 市场部 '),(' 财务部 ');</p>
<h3 id="创建员工表"><a class="anchor" href="#创建员工表">#</a> 创建员工表</h3>
<p>CREATE TABLE emp (<br>
id INT PRIMARY KEY AUTO_INCREMENT,<br>
NAME VARCHAR(10),<br>
gender CHAR (1), -- 性别<br>
 salary DOUBLE, -- 工资<br>
 join_date DATE, -- 入职日期<br>
 dept_id INT,<br>
FOREIGN KEY (dept_id) REFERENCES dept (id) -- 外键，关联部门表 (部门表的主键)<br>
);<br>
INSERT INTO emp (NAME,gender,salary,join_date,dept_id) VALUES (' 孙悟空 ',' 男 ',7200,'2013-02-24',1);<br>
INSERT INTO emp (NAME,gender,salary,join_date,dept_id) VALUES (' 猪八戒 ',' 男 ',3600,'2010-12-02',2);<br>
INSERT INTO emp (NAME,gender,salary,join_date,dept_id) VALUES (' 唐僧 ',' 男 ',9000,'2008-08-08',2);<br>
INSERT INTO emp (NAME,gender,salary,join_date,dept_id) VALUES (' 白骨精 ',' 女 ',5000,'2015-10-07',3);<br>
INSERT INTO emp (NAME,gender,salary,join_date,dept_id) VALUES (' 蜘蛛精 ',' 女 ',4500,'2011-03-14',1);</p>
</li>
<li>
<p>笛卡尔积：</p>
<ul>
<li>有两个集合 A,B . 取这两个集合的所有组成情况。</li>
<li>要完成多表查询，需要消除无用的数据</li>
</ul>
</li>
<li>
<p>多表查询的分类：</p>
<ol>
<li>内连接查询：
<ol>
<li>
<p>隐式内连接：使用 where 条件消除无用数据</p>
<ul>
<li>例子：<br>
-- 查询所有员工信息和对应的部门信息</li>
</ul>
<p>SELECT * FROM emp,dept WHERE emp. <code>dept_id</code>  = dept. <code>id</code> ;</p>
<p>-- 查询员工表的名称，性别。部门表的名称<br>
 SELECT <span class="exturl" data-url="aHR0cDovL2VtcC5uYW1l">emp.name</span>,emp.gender,<span class="exturl" data-url="aHR0cDovL2RlcHQubmFtZQ==">dept.name</span> FROM emp,dept WHERE emp. <code>dept_id</code>  = dept. <code>id</code> ;</p>
<p>SELECT<br>
<span class="exturl" data-url="aHR0cDovL3QxLm5hbWU=">t1.name</span>, -- 员工表的姓名<br>
 t1.gender,-- 员工表的性别<br>
<span class="exturl" data-url="aHR0cDovL3QyLm5hbWU="> t2.name</span> -- 部门表的名称<br>
 FROM<br>
emp t1,<br>
dept t2<br>
WHERE<br>
t1. <code>dept_id</code>  = t2. <code>id</code> ;</p>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<p>​	<br>
​		2. 显式内连接：<br>
​			* 语法： select 字段列表 from 表名 1 [inner] join 表名 2 on 条件<br>
​			* 例如：<br>
​				* SELECT * FROM emp INNER JOIN dept ON emp. <code>dept_id</code>  = dept. <code>id</code> ;	<br>
​				* SELECT * FROM emp JOIN dept ON emp. <code>dept_id</code>  = dept. <code>id</code> ;</p>
<pre><code>3. 内连接查询：
	1. 从哪些表中查询数据
	2. 条件是什么
	3. 查询哪些字段
</code></pre>
<ol start="2">
<li>外链接查询：
<ol>
<li>左外连接：
<ul>
<li>语法：select 字段列表 from 表 1 left [outer] join 表 2 on 条件；</li>
<li>查询的是左表所有数据以及其交集部分。</li>
<li>例子：<br>
-- 查询所有员工信息，如果员工有部门，则查询部门名称，没有部门，则不显示部门名称<br>
 SELECT 	t1.*,t2. <code>name</code>  FROM emp t1 LEFT JOIN dept t2 ON t1. <code>dept_id</code>  = t2. <code>id</code> ;</li>
</ul>
</li>
<li>右外连接：
<ul>
<li>语法：select 字段列表 from 表 1 right [outer] join 表 2 on 条件；</li>
<li>查询的是右表所有数据以及其交集部分。</li>
<li>例子：<br>
SELECT 	* FROM dept t2 RIGHT JOIN emp t1 ON t1. <code>dept_id</code>  = t2. <code>id</code> ;</li>
</ul>
</li>
</ol>
</li>
<li>子查询：
<ul>
<li>
<p>概念：查询中嵌套查询，称嵌套查询为子查询。<br>
-- 查询工资最高的员工信息<br>
 -- 1 查询最高的工资是多少 9000<br>
SELECT MAX(salary) FROM emp;</p>
<p>-- 2 查询员工信息，并且工资等于 9000 的<br>
 SELECT * FROM emp WHERE emp. <code>salary</code>  = 9000;</p>
<p>-- 一条 sql 就完成这个操作。子查询<br>
 SELECT * FROM emp WHERE emp. <code>salary</code>  = (SELECT MAX(salary) FROM emp);</p>
</li>
<li>
<p>子查询不同情况</p>
<ol>
<li>
<p>子查询的结果是单行单列的：</p>
<ul>
<li>子查询可以作为条件，使用运算符去判断。 运算符： &gt; &gt;= &lt; &lt;= =</li>
<li></li>
</ul>
<p>-- 查询员工工资小于平均工资的人<br>
 SELECT * FROM emp WHERE emp.salary &lt;(SELECT AVG (salary) FROM emp);</p>
</li>
<li>
<p>子查询的结果是多行单列的：</p>
<ul>
<li>子查询可以作为条件，使用运算符 in 来判断<br>
 -- 查询 ' 财务部 ' 和' 市场部 ' 所有的员工信息<br>
 SELECT id FROM dept WHERE NAME = ' 财务部 ' OR NAME = ' 市场部 ';<br>
SELECT * FROM emp WHERE dept_id = 3 OR dept_id = 2;<br>
-- 子查询<br>
 SELECT * FROM emp WHERE dept_id IN (SELECT id FROM dept WHERE NAME = ' 财务部 ' OR NAME = ' 市场部 ');</li>
</ul>
</li>
<li>
<p>子查询的结果是多行多列的：</p>
<ul>
<li>子查询可以作为一张虚拟表参与查询<br>
 -- 查询员工入职日期是 2011-11-11 日之后的员工信息和部门信息<br>
 -- 子查询<br>
 SELECT * FROM dept t1 ,(SELECT * FROM emp WHERE emp. <code>join_date</code>  &gt; '2011-11-11') t2<br>
WHERE <span class="exturl" data-url="aHR0cDovL3QxLmlk">t1.id</span> = t2.dept_id;</li>
</ul>
<p>-- 普通内连接<br>
 SELECT * FROM emp t1,dept t2 WHERE t1. <code>dept_id</code>  = t2. <code>id</code>  AND t1. <code>join_date</code>  &gt;  '2011-11-11'</p>
</li>
</ol>
</li>
</ul>
</li>
</ol>
<ul>
<li>
<p>多表查询练习</p>
<pre><code>  -- 部门表
  CREATE TABLE dept (
    id INT PRIMARY KEY PRIMARY KEY, -- 部门id
    dname VARCHAR(50), -- 部门名称
    loc VARCHAR(50) -- 部门所在地
  );
  
  -- 添加4个部门
  INSERT INTO dept(id,dname,loc) VALUES 
  (10,'教研部','北京'),
  (20,'学工部','上海'),
  (30,'销售部','广州'),
  (40,'财务部','深圳');
</code></pre>
</li>
</ul>
<p>​				<br>
​</p>
<p>​			-- 职务表，职务名称，职务描述<br>
​			CREATE TABLE job (<br>
​			  id INT PRIMARY KEY,<br>
​			  jname VARCHAR(20),<br>
​			  description VARCHAR(50)<br>
​			);<br>
​			<br>
​			-- 添加 4 个职务<br>
​			INSERT INTO job (id, jname, description) VALUES<br>
​			(1, ' 董事长 ', ' 管理整个公司，接单 '),<br>
​			(2, ' 经理 ', ' 管理部门员工 '),<br>
​			(3, ' 销售员 ', ' 向客人推销产品 '),<br>
​			(4, ' 文员 ', ' 使用办公软件 ');</p>
<p>​				<br>
​</p>
<p>​			-- 员工表<br>
​			CREATE TABLE emp (<br>
​			  id INT PRIMARY KEY, -- 员工 id<br>
​			  ename VARCHAR (50), -- 员工姓名<br>
​			  job_id INT, -- 职务 id<br>
​			  mgr INT , -- 上级领导<br>
​			  joindate DATE, -- 入职日期<br>
​			  salary DECIMAL (7,2), -- 工资<br>
​			  bonus DECIMAL (7,2), -- 奖金<br>
​			  dept_id INT, -- 所在部门编号<br>
​			  CONSTRAINT emp_jobid_ref_job_id_fk FOREIGN KEY (job_id) REFERENCES job (id),<br>
​			  CONSTRAINT emp_deptid_ref_dept_id_fk FOREIGN KEY (dept_id) REFERENCES dept (id)<br>
​			);<br>
​			<br>
​			-- 添加员工<br>
​			INSERT INTO emp (id,ename,job_id,mgr,joindate,salary,bonus,dept_id) VALUES<br>
​			(1001,' 孙悟空 ',4,1004,'2000-12-17','8000.00',NULL,20),<br>
​			(1002,' 卢俊义 ',3,1006,'2001-02-20','16000.00','3000.00',30),<br>
​			(1003,' 林冲 ',3,1006,'2001-02-22','12500.00','5000.00',30),<br>
​			(1004,' 唐僧 ',2,1009,'2001-04-02','29750.00',NULL,20),<br>
​			(1005,' 李逵 ',4,1006,'2001-09-28','12500.00','14000.00',30),<br>
​			(1006,' 宋江 ',2,1009,'2001-05-01','28500.00',NULL,30),<br>
​			(1007,' 刘备 ',2,1009,'2001-09-01','24500.00',NULL,10),<br>
​			(1008,' 猪八戒 ',4,1004,'2007-04-19','30000.00',NULL,20),<br>
​			(1009,' 罗贯中 ',1,NULL,'2001-11-17','50000.00',NULL,10),<br>
​			(1010,' 吴用 ',3,1006,'2001-09-08','15000.00','0.00',30),<br>
​			(1011,' 沙僧 ',4,1004,'2007-05-23','11000.00',NULL,20),<br>
​			(1012,' 李逵 ',4,1006,'2001-12-03','9500.00',NULL,30),<br>
​			(1013,' 小白龙 ',4,1004,'2001-12-03','30000.00',NULL,20),<br>
​			(1014,' 关羽 ',4,1007,'2002-01-23','13000.00',NULL,10);</p>
<p>​				<br>
​</p>
<p>​			-- 工资等级表<br>
​			CREATE TABLE salarygrade (<br>
​			  grade INT PRIMARY KEY,   -- 级别<br>
​			  losalary INT,  -- 最低工资<br>
​			  hisalary INT -- 最高工资<br>
​			);<br>
​			<br>
​			-- 添加 5 个工资等级<br>
​			INSERT INTO salarygrade (grade,losalary,hisalary) VALUES<br>
​			(1,7000,12000),<br>
​			(2,12010,14000),<br>
​			(3,14010,20000),<br>
​			(4,20010,30000),<br>
​			(5,30010,99990);<br>
​			<br>
​			-- 需求：<br>
​			<br>
​			-- 1. 查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述<br>
​			/*<br>
​				分析：<br>
​					1. 员工编号，员工姓名，工资，需要查询 emp 表  职务名称，职务描述 需要查询 job 表<br>
​					2. 查询条件 emp.job_id = <span class="exturl" data-url="aHR0cDovL2pvYi5pZA==">job.id</span><br>
​			<br>
​			*/<br>
​			SELECT<br>
​				t1. <code>id</code> , -- 员工编号<br>
​				t1. <code>ename</code> , -- 员工姓名<br>
​				t1. <code>salary</code> ,-- 工资<br>
​				t2. <code>jname</code> , -- 职务名称<br>
​				t2. <code>description</code>  -- 职务描述<br>
​			FROM<br>
​				emp t1, job t2<br>
​			WHERE<br>
​				t1. <code>job_id</code>  = t2. <code>id</code> ;</p>
<p>​				<br>
​</p>
<p>​			-- 2. 查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置<br>
​			/*<br>
​				分析：</p>
<pre><code>			1. 员工编号，员工姓名，工资 emp  职务名称，职务描述 job  部门名称，部门位置 dept
			2. 条件： emp.job_id = job.id and emp.dept_id = dept.id
	*/
	
	SELECT 
		t1.`id`, -- 员工编号
		t1.`ename`, -- 员工姓名
		t1.`salary`,-- 工资
		t2.`jname`, -- 职务名称
		t2.`description`, -- 职务描述
		t3.`dname`, -- 部门名称
		t3.`loc` -- 部门位置
	FROM 
		emp t1, job t2,dept t3
	WHERE 
		t1.`job_id` = t2.`id` AND t1.`dept_id` = t3.`id`;
	
	-- 3.查询员工姓名，工资，工资等级
	/*
		分析：
			1.员工姓名，工资 emp  工资等级 salarygrade
			2.条件 emp.salary &gt;= salarygrade.losalary and emp.salary &lt;= salarygrade.hisalary
				emp.salary BETWEEN salarygrade.losalary and salarygrade.hisalary
	*/
	SELECT 
		t1.ename ,
		t1.`salary`,
		t2.*
	FROM emp t1, salarygrade t2
	WHERE t1.`salary` BETWEEN t2.`losalary` AND t2.`hisalary`;
</code></pre>
<p>​				<br>
​</p>
<p>​			-- 4. 查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级<br>
​			/*<br>
​				分析：</p>
<pre><code>			1. 员工姓名，工资 emp ， 职务名称，职务描述 job 部门名称，部门位置，dept  工资等级 salarygrade
			2. 条件： emp.job_id = job.id and emp.dept_id = dept.id and emp.salary BETWEEN salarygrade.losalary and salarygrade.hisalary
				
	*/
	SELECT 
		t1.`ename`,
		t1.`salary`,
		t2.`jname`,
		t2.`description`,
		t3.`dname`,
		t3.`loc`,
		t4.`grade`
	FROM 
		emp t1,job t2,dept t3,salarygrade t4
	WHERE 
		t1.`job_id` = t2.`id` 
		AND t1.`dept_id` = t3.`id`
		AND t1.`salary` BETWEEN t4.`losalary` AND t4.`hisalary`;
</code></pre>
<p>​				<br>
​</p>
<p>​			-- 5. 查询出部门编号、部门名称、部门位置、部门人数<br>
​			<br>
​			/*<br>
​				分析：<br>
​					1. 部门编号、部门名称、部门位置 dept 表。 部门人数 emp 表<br>
​					2. 使用分组查询。按照 emp.dept_id 完成分组，查询 count (id)<br>
​					3. 使用子查询将第 2 步的查询结果和 dept 表进行关联查询<br>
​					<br>
​			*/<br>
​			SELECT<br>
​				t1. <code>id</code> ,t1. <code>dname</code> ,t1. <code>loc</code>  , t2.total<br>
​			FROM<br>
​				dept t1,<br>
​				(SELECT<br>
​					dept_id,COUNT(id) total<br>
​				FROM<br>
​					emp<br>
​				GROUP BY dept_id) t2<br>
​			WHERE t1. <code>id</code>  = t2.dept_id;</p>
<p>​</p>
<p>​			-- 6. 查询所有员工的姓名及其直接上级的姓名，没有领导的员工也需要查询<br>
​			<br>
​			/*<br>
​				分析：<br>
​					1. 姓名 emp， 直接上级的姓名 emp</p>
<h2 id="事务"><a class="anchor" href="#事务">#</a> 事务</h2>
<ol>
<li>事务的基本介绍
<ol>
<li>
<p>概念：</p>
<ul>
<li>如果一个包含多个步骤的业务操作，被事务管理，那么这些操作要么同时成功，要么同时失败。</li>
</ul>
</li>
<li>
<p>操作：</p>
<ol>
<li>开启事务： start transaction;</li>
<li>回滚：rollback;</li>
<li>提交：commit;</li>
</ol>
</li>
<li>
<p>例子：<br>
CREATE TABLE account (<br>
id INT PRIMARY KEY AUTO_INCREMENT,<br>
NAME VARCHAR(10),<br>
balance DOUBLE<br>
);<br>
-- 添加数据<br>
 INSERT INTO account (NAME, balance) VALUES ('zhangsan', 1000), ('lisi', 1000);</p>
</li>
</ol>
</li>
</ol>
<p>​</p>
<p>​		SELECT * FROM account;<br>
​		UPDATE account SET balance = 1000;<br>
​		-- 张三给李四转账 500 元<br>
​		<br>
​		-- 0. 开启事务<br>
​		START TRANSACTION;<br>
​		-- 1. 张三账户 -500<br>
​		<br>
​		UPDATE account SET balance = balance - 500 WHERE NAME = 'zhangsan';<br>
​		-- 2. 李四账户 +500<br>
​		-- 出错了...<br>
​		UPDATE account SET balance = balance + 500 WHERE NAME = 'lisi';<br>
​		<br>
​		-- 发现执行没有问题，提交事务<br>
​		COMMIT;<br>
​		<br>
​		-- 发现出问题了，回滚事务<br>
​		ROLLBACK;</p>
<ol start="4">
<li>
<p>MySQL 数据库中事务默认自动提交</p>
<ul>
<li>事务提交的两种方式：
<ul>
<li>自动提交：
<ul>
<li>mysql 就是自动提交的</li>
<li>一条 DML (增删改) 语句会自动提交一次事务。</li>
</ul>
</li>
<li>手动提交：
<ul>
<li>Oracle 数据库默认是手动提交事务</li>
<li>需要先开启事务，再提交</li>
</ul>
</li>
</ul>
</li>
<li>修改事务的默认提交方式：
<ul>
<li>查看事务的默认提交方式：SELECT @@autocommit; -- 1 代表自动提交  0 代表手动提交</li>
<li>修改默认提交方式： set @@autocommit = 0;</li>
</ul>
</li>
</ul>
</li>
<li>
<p>事务的四大特征：</p>
<ol>
<li>原子性：是不可分割的最小操作单位，要么同时成功，要么同时失败。</li>
<li>持久性：当事务提交或回滚后，数据库会持久化的保存数据。</li>
<li>隔离性：多个事务之间。相互独立。</li>
<li>一致性：事务操作前后，数据总量不变</li>
</ol>
</li>
<li>
<p>事务的隔离级别（了解）</p>
<ul>
<li>
<p>概念：多个事务之间隔离的，相互独立的。但是如果多个事务操作同一批数据，则会引发一些问题，设置不同的隔离级别就可以解决这些问题。</p>
</li>
<li>
<p>存在问题：</p>
<ol>
<li>脏读：一个事务，读取到另一个事务中没有提交的数据</li>
<li>不可重复读 (虚读)：在同一个事务中，两次读取到的数据不一样。</li>
<li>幻读：一个事务操作 (DML) 数据表中所有记录，另一个事务添加了一条数据，则第一个事务查询不到自己的修改。</li>
</ol>
</li>
<li>
<p>隔离级别：</p>
<ol>
<li>read uncommitted：读未提交
<ul>
<li>产生的问题：脏读、不可重复读、幻读</li>
</ul>
</li>
<li>read committed：读已提交 （Oracle）
<ul>
<li>产生的问题：不可重复读、幻读</li>
</ul>
</li>
<li>repeatable read：可重复读 （MySQL 默认）
<ul>
<li>产生的问题：幻读</li>
</ul>
</li>
<li>serializable：串行化
<ul>
<li>可以解决所有的问题</li>
</ul>
</li>
</ol>
<ul>
<li>注意：隔离级别从小到大安全性越来越高，但是效率越来越低</li>
<li>数据库查询隔离级别：
<ul>
<li>select @@tx_isolation;</li>
</ul>
</li>
<li>数据库设置隔离级别：
<ul>
<li>set global transaction isolation level  级别字符串；</li>
</ul>
</li>
</ul>
</li>
<li>
<p>演示：<br>
set global transaction isolation level read uncommitted;<br>
start transaction;<br>
-- 转账操作<br>
 update account set balance = balance - 500 where id = 1;<br>
update account set balance = balance + 500 where id = 2;</p>
</li>
</ul>
</li>
</ol>
<h2 id="dcl"><a class="anchor" href="#dcl">#</a> DCL：</h2>
<ul>
<li>
<p>SQL 分类：</p>
<ol>
<li>DDL：操作数据库和表</li>
<li>DML：增删改表中数据</li>
<li>DQL：查询表中数据</li>
<li>DCL：管理用户，授权</li>
</ol>
</li>
<li>
<p>DBA：数据库管理员</p>
</li>
<li>
<p>DCL：管理用户，授权</p>
<ol>
<li>管理用户
<ol>
<li>
<p>添加用户：</p>
<ul>
<li>语法：CREATE USER ' 用户名 '@' 主机名 ' IDENTIFIED BY ' 密码 ';</li>
</ul>
</li>
<li>
<p>删除用户：</p>
<ul>
<li>语法：DROP USER ' 用户名 '@' 主机名 ';</li>
</ul>
</li>
<li>
<p>修改用户密码：</p>
<p>UPDATE USER SET PASSWORD = PASSWORD (' 新密码 ') WHERE USER = ' 用户名 ';<br>
UPDATE USER SET PASSWORD = PASSWORD('abc') WHERE USER = 'lisi';</p>
</li>
</ol>
</li>
</ol>
<p>SET PASSWORD FOR ' 用户名 '@' 主机名 ' = PASSWORD (' 新密码 ');<br>
SET PASSWORD FOR 'root'@'localhost' = PASSWORD('123');</p>
<ul>
<li>mysql 中忘记了 root 用户的密码？</li>
</ul>
<ol>
<li>
<p>cmd -- &gt; net stop mysql 停止 mysql 服务<br>
 * 需要管理员运行该 cmd</p>
<pre><code> 2. 使用无验证方式启动mysql服务： mysqld --skip-grant-tables
 3. 打开新的cmd窗口,直接输入mysql命令，敲回车。就可以登录成功
 4. use mysql;
 5. update user set password = password('你的新密码') where user = 'root';
 6. 关闭两个窗口
 7. 打开任务管理器，手动结束mysqld.exe 的进程
 8. 启动mysql服务
 9. 使用新密码登录。
</code></pre>
</li>
<li>
<p>查询用户：<br>
-- 1. 切换到 mysql 数据库<br>
 USE myql;<br>
-- 2. 查询 user 表<br>
 SELECT * FROM USER;</p>
<ul>
<li>通配符： % 表示可以在任意主机使用用户登录数据库</li>
</ul>
</li>
<li>
<p>权限管理：</p>
<ol>
<li>
<p>查询权限：<br>
-- 查询权限<br>
 SHOW GRANTS FOR ' 用户名 '@' 主机名 ';<br>
SHOW GRANTS FOR 'lisi'@'%';</p>
</li>
<li>
<p>授予权限：<br>
-- 授予权限<br>
 grant 权限列表 on 数据库名。表名 to ' 用户名 '@' 主机名 ';<br>
-- 给张三用户授予所有权限，在任意数据库任意表上</p>
<p>GRANT ALL ON <em>.</em> TO 'zhangsan'@'localhost';</p>
</li>
<li>
<p>撤销权限：<br>
-- 撤销权限：<br>
revoke 权限列表 on 数据库名。表名 from ' 用户名 '@' 主机名 ';<br>
REVOKE UPDATE ON db3. <code>account</code>  FROM 'lisi'@'%';</p>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      <div class="tags">
          <a href="/tags/MySQL/" rel="tag"><i class="ic i-tag"></i> MySQL</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2020-10-03 10:57:36" itemprop="dateModified" datetime="2020-10-03T10:57:36+08:00">2020-10-03</time>
  </span>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>手撕包菜 <i class="ic i-at"><em>@</em></i>手撕包菜
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="https://www.baocai-blog.cn/2020/09/30/MySQL%E5%A4%9A%E8%A1%A8-%E4%BA%8B%E5%8A%A1/" title="MySQL多表和事务">https://www.baocai-blog.cn/2020/09/30/MySQL多表-事务/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="nav">
    <div class="item left">
      

  <a href="/2020/09/30/MySQL%E7%BA%A6%E6%9D%9F/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclize41wj20zk0m87gk.jpg" title="MySQL约束">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> 数据库</span>
  <h3>MySQL约束</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2020/09/30/MySQL%E5%9F%BA%E7%A1%80/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeyvx1d4j20zk0m8hdt.jpg" title="MySQL基础">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> 数据库</span>
  <h3>MySQL基础</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text"> 目录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.1.</span> <span class="toc-text"> 多表查询：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%83%A8%E9%97%A8%E8%A1%A8"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 创建部门表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%91%98%E5%B7%A5%E8%A1%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text"> 创建员工表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.2.</span> <span class="toc-text"> 事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dcl"><span class="toc-number">1.3.</span> <span class="toc-text"> DCL：</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
        <ul>
          <li><a href="/2020/09/30/MySQL%E5%9F%BA%E7%A1%80/" rel="bookmark" title="MySQL基础">MySQL基础</a></li><li class="active"><a href="/2020/09/30/MySQL%E5%A4%9A%E8%A1%A8-%E4%BA%8B%E5%8A%A1/" rel="bookmark" title="MySQL多表和事务">MySQL多表和事务</a></li><li><a href="/2020/09/30/MySQL%E7%BA%A6%E6%9D%9F/" rel="bookmark" title="MySQL约束">MySQL约束</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="手撕包菜"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">手撕包菜</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">4</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">2</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">2</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NzYmFvY2Fp" title="https:&#x2F;&#x2F;github.com&#x2F;ssbaocai"><i class="ic i-github"></i></span>
      <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span>
      <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span>
      <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

        
  <li class="item dropdown">
    <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

  </ul>

</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2020/09/30/MySQL%E7%BA%A6%E6%9D%9F/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2020/09/30/MySQL%E5%9F%BA%E7%A1%80/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2020</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">手撕包菜 @ baocai's blog</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">25k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">23 分钟</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2020/09/30/MySQL多表-事务/',
    favicon: {
      show: "（●´3｀●）やれやれだぜ",
      hide: "(´Д｀)大変だ！"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 ${query} ，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2"></script>




</body>
</html>
